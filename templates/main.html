<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/dark.css">
        <link rel="stylesheet" href="/static/styles.css">

        <style>
            .box-style
            {             
                border-radius: 25px;
                padding: 5px 30px 10px 30px;
            }

            .flexboxrow
            {
                display: flex;
                height: 40%;
                align-items: stretch;
                justify-content: center;
            }
            .flexboxrow > div 
            {
                width: 40%;
                margin: 10px;
            }

            .flexboxcol
            {
                display: flex;
                height: 150%;
                flex-direction: column;
            }
            .flexboxcol > div 
            {
                width: 170%;
                transform: translate(-20%, 0%);
                margin: 10px;
            }
        </style>
    </head>
    <body>
        <div class="flexboxcol">
            <a href="/">
                <div class="nav-bar">
                    <h1> D&D GM Board </h1>
                </div>
            </a>

            <div class="flexboxrow">
                
                <div class="characters page box-style">
                    <h2>Characters</h2>
                    {% for player in players %}
                        <p value="{{ player.id }}">{{ player.name }}</p>
                        <ul>
                            <li>
                                HP: {{player.current_health}}/{{player.max_health}}
                            </li>
                            <li>
                                <table>
                                    <tr>
                                        <th>Strength</th>
                                        <th>Dexterity</th>
                                        <th>Const.</th>
                                        <th>Intell.</th>
                                        <th>Wisdom</th>
                                        <th>Charisma</th>
                                    </tr>
                                    <tr>
                                        {% for ability in player.abilities %} 
                                        <td>{{ability}}</td>
                                        {% endfor %}
                                    </tr>
                                </table>
                            </li>
                        </ul>
                    {% endfor %}

                </div>
                <div class="monsters page box-style">
                    <h2>Monsters</h2>
                    <label for="challenge">Challenge rating: </label>
                    <input type="number" name="challenge" id="challenge" style="width:15%;">

                    <a id="searchMonsterLink" href="#">
                    <button style="position: absolute; top: 100px; left: 30%;"> 
                            Search 
                    </button>
                    </a>

                    <label for="monster-select" style="position: absolute; top: 75px; left: 55%;">List of monsters with that level: </label>
                    <select style="position: absolute; top: 100px; left: 55%;"
                            id="monster-select"
                            onchange="fetchMonsterDetails(this.value)">
                        <option>Select one</option>
                        {% for monster in monsters %}
                        <option value="{{ monster.index }}">{{ monster.name }}</option>
                        {% endfor %}
                    </select>

                    <h2> Monster details </h2>
                    <p id="type">Species: </p>
                    <p id="alignment">Alignment: </p>

                    <p id="monster-hp">HP: </p>
                    <p id="monster-dice">Attack: </p>

                    <table>
                        <tr>
                            <th>Strength</th>
                            <th>Dexterity</th>
                            <th>Const.</th>
                            <th>Intell.</th>
                            <th>Wisdom</th>
                            <th>Charisma</th>
                        </tr>
                        <tr>
                            <td id="str"></td>
                            <td id="dex"></td>
                            <td id="con"></td>
                            <td id="int"></td>
                            <td id="wis"></td>
                            <td id="cha"></td>
                        </tr>
                    </table>

                    <button id="add-monster-button" onclick="addMonster()">
                        Add monster
                    </button>

                </div>
            </div>

            <div class="flexboxrow">
                
                <div class="page box-style">
                    <h2>Something</h2>

                </div>
                <div class="page box-style">
                    <h2>Current interaction</h2>

                    <h3>Monsters to beat</h3>

                    <div id="current-monsters"></div>

                    <h3>Items to gain</h3>

                    <div id="current_items"></div>
                </div>
            </div>
        </div>
    </body>
</html>



<script>
// Get the necessary elements
const challengeInput = document.getElementById('challenge');
const searchMonsterLink = document.getElementById('searchMonsterLink');

// Event listener to update the href when input changes
challengeInput.addEventListener('input', () => {
    const challengeValue = challengeInput.value; // Get the input value
    const game_id = "{{game.game_id}}"; // Use the existing game name
    searchMonsterLink.href = `/STARTGAME?game_id=${game_id}&challenge_index=${challengeValue}`;
});
</script>

<script>
function fetchMonsterDetails(monsterIndex) {
    if (!monsterIndex) return; // Do nothing if no monster is selected

    try {
        // Replace with your API endpoint
        const response = fetch(`https://www.dnd5eapi.co/api/monsters/${monsterIndex}`);
        if (!response.ok) throw new Error("Failed to fetch monster details.");

        const data = response.json();

        // Update the page with monster details
        document.getElementById("type").textContent = `Species: ${data.type}`;
        document.getElementById("alignment").textContent = `Alignment: ${data.alignment}`;

        document.getElementById("monster-hp").textContent = `HP: ${data.hit_points}`;
        document.getElementById("monster-dice").textContent = `Attack: ${data.hit_points_roll}`;

        document.getElementById("str").textContent = `${data.strength}`;
        document.getElementById("dex").textContent = `${data.dexterity}`;
        document.getElementById("con").textContent = `${data.constitution}`;
        document.getElementById("int").textContent = `${data.intelligence}`;
        document.getElementById("wis").textContent = `${data.wisdom}`;
        document.getElementById("cha").textContent = `${data.charisma}`;
    } catch (error) {
        console.error("Error fetching monster details:", error);
    }
}

monsterList = [];
itemList = [];

function addMonster() 
{
    monster_index = document.getElementById("monster-select").value;
    if (!monster_index) return; // Do nothing if no monster is selected

    try {
        // Update the page with monster details
        monsterList.push(monster_index);

        displayMonsterList();
    } catch (error) {
        console.error("Error fetching monster details:", error);
    }
}

function displayMonsterList()
{
    const currentMonsters = document.querySelector('#current-monsters');
    currentMonsters.innerHTML = "";

    // Loop through the playerList and create a <li> for each item
    monsterList.forEach(item => {
        const response = fetch(`https://www.dnd5eapi.co/api/monsters/${item}`);
        if (!response.ok) throw new Error("Failed to fetch monster details.");

        const data = response.json();

        const li = document.createElement("li");

        // Add the item text to the <li>
        li.textContent = data.name;

        // Append the <li> to the list container
        currentMonsters.appendChild(li);
    });
}
</script>