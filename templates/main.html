<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/dark.css">
        <link rel="stylesheet" href="/static/styles.css">

        <style>
            .box-style
            {             
                border-radius: 25px;
                padding: 5px 30px 10px 30px;
            }

            .flexboxrow
            {
                display: flex;
                height: 40%;
                align-items: stretch;
                justify-content: center;
            }
            .flexboxrow > div 
            {
                width: 40%;
                margin: 10px;
            }

            .flexboxcol
            {
                display: flex;
                height: 150%;
                flex-direction: column;
            }
            .flexboxcol > div 
            {
                width: 170%;
                transform: translate(-20%, 0%);
                margin: 10px;
            }
        </style>
    </head>
    <body>
        <div class="flexboxcol">
            <a href="/">
                <div class="nav-bar">
                    <h1> D&D GM Board </h1>
                </div>
            </a>

            <div class="flexboxrow">
                
                <div class="characters page box-style">
                    <h2>Characters</h2>
                    {% for player in players %}
                        <p value="{{ player }}">{{ player.name }}</p>
                        <ul>
                            <li>
                                HP: {{player.current_HP}}/{{player.max_HP}}
                            </li>
                            <li>
                                Abilities: {% for ithability in player.ability %} {{ithability}} {% endfor %}
                            </li>
                        </ul>
                    {% endfor %}

                </div>
                <div class="monsters page box-style">
                    <h2>Monsters</h2>
                    <label>Challenge rating: </label>
                    <input type="number" name="challenge" id="challenge" style="width:15%;">

                    <a id="searchMonsterLink" href="#">
                    <button style="position: absolute; top: 21%; left: 30%;"> 
                            Search 
                    </button>
                    </a>

                    <label style="position: absolute; top: 14%; left: 55%;">List of monsters with that level: </label>
                    <select style="position: absolute; top: 21%; left: 55%;"
                            id="monster-select"
                            onchange="fetchMonsterDetails(this.value)">
                        <option>Select one</option>
                        {% for monster in monsters %}
                        <option value="{{ monster.index }}">{{ monster.name }}</option>
                        {% endfor %}
                    </select>

                    <p> Monster details </p>
                    <p id="monster-hp">HP: </p>
                    <p id="monster-dice">Dice: </p>


                </div>
            </div>

            <div class="flexboxrow">
                
                <div class="page box-style">
                    <h2>Something</h2>

                </div>
                <div class="page box-style">
                    <h2>Something</h2>

                </div>
            </div>
        </div>
    </body>
</html>



<script>
    // Get the necessary elements
    const challengeInput = document.getElementById('challenge');
    const searchMonsterLink = document.getElementById('searchMonsterLink');

    // Event listener to update the href when input changes
    challengeInput.addEventListener('input', () => {
        const challengeValue = challengeInput.value; // Get the input value
        const gameName = "{{game.name}}"; // Use the existing game name
        searchMonsterLink.href = `/STARTGAME?gameName=${gameName}&challenge_index=${challengeValue}`;
    });
</script>

<script>
    async function fetchMonsterDetails(monsterIndex) {
        if (!monsterIndex) return; // Do nothing if no monster is selected
  
        try {
            // Replace with your API endpoint
            const response = await fetch(`https://www.dnd5eapi.co/api/monsters/${monsterIndex}`);
            if (!response.ok) throw new Error("Failed to fetch monster details.");
    
            const data = await response.json();
  
            // Update the page with monster details
            document.getElementById("monster-hp").textContent = `HP: ${data.hit_points}`;
            document.getElementById("monster-dice").textContent = `Attack: ${data.hit_dice}`;
        } catch (error) {
            console.error("Error fetching monster details:", error);
        }
    }
</script>